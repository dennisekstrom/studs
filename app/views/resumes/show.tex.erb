<%
  experiences = @r.experiences_by_kind
  linkedin = @r.linkedin_url? ? linkedin_id(@r.linkedin_url) : nil
%>
% Resume for <%= @r.name %>
\nonstopmode

\def\name{<%=htex @r.name %>}
\makeatletter
\date{<%=htex Time.now.strftime('%F') %>} \let\thedate\@date
\makeatother
\title{<%=htex @r.name %> - StuDs Resume}
\author{\name}

%{{{ Document setup
\documentclass[a4paper,11pt]{article}

% Text configuration
\usepackage[utf8]{inputenc}
\usepackage[<%= t('resumes.pdf.babel_language') %>]{babel}
\usepackage{lmodern} % font
%\renewcommand{\familydefault}{\sfdefault} % default family

% Additional symbols
\usepackage{amssymb}
% [http://www.tex.ac.uk/tex-archive/info/symbols/comprehensive/symbols-a4.pdf]
\usepackage{marvosym}
\usepackage{textcomp}

% Images
\usepackage{graphicx}
\usepackage[absolute,overlay]{textpos}

% Colors [http://ctan.uib.no/macros/latex/contrib/xcolor/xcolor.pdf]
\usepackage[svgnames]{xcolor}

% Paragraphs
\parindent 0mm
\parskip 0mm

% Margins
\usepackage[top=1.6cm, bottom=1.6cm, left=2.5cm, right=2cm]{geometry}
\newlength{\titleleft}
\newlength{\titlefwidth}
\setlength{\titlefwidth}{\textwidth}
\setlength{\titleleft}{-0.5cm}
\addtolength{\titlefwidth}{0.5cm}

% Header and text formatting
\usepackage{titlesec}

% CV sections
\titleformat{\section}{\sf \bfseries \Large}{\thesection}{}{}[\vspace{-5mm}\rule{\titlefwidth}{1pt}]
% Work places / bold leaders
\titleformat{\subsection}[runin]{\normalsize}{\thesubsection}{}{}
% Work titles
\titleformat{\subsubsection}{\normalsize}{\thesubsubsection}{}{}

% Spacing
\titlespacing{\section}{\titleleft}{5mm}{1mm}
\titlespacing{\subsection}{\titleleft}{3mm}{1mm}
\titlespacing{\subsubsection}{1mm}{2mm}{1mm}

% Hyperlinking
\usepackage[pdftex]{hyperref}
\hypersetup{%
  colorlinks = true,%
  linkcolor  = Black,%
  urlcolor   = Navy%
}

% Footer
\usepackage{lastpage}
\usepackage{fancyhdr}
\pagestyle{fancy}
\renewcommand{\headrulewidth}{0pt}
\cfoot{\thepage\ / \pageref{LastPage}}

%}}}
%{{{ Custom formats and commands

\newcommand{\icon}[1]{\textcolor{lightgray}{#1}}
\newcommand{\iconl}[1]{\hspace{-0.5cm}\makebox[0.3cm][c]{\icon{#1}}\hspace{0.2cm}}

% Headers
\newcommand{\theheader}[0]{\sf \LARGE \bfseries \name}
\newcommand{\worktitle}[1]{\textbf{#1}}
\newcommand{\duration}[1]{\textsl{#1}}
\newcommand{\theplace}[2][]{\subsection*{\textbf{#2}#1}}
\newcommand{\thework}[2]{\subsubsection*{%
  \iconl{$\blacksquare$}%
  \worktitle{#1}%
  \hfill\duration{#2}}\par%
}
\newcommand{\thebold}[1]{\subsection*{\textbf{#1}}\vspace{-1mm}}
%}}}

\begin{document}

% Name
\hspace{\titleleft}\parbox{\titlefwidth}{%
{\theheader}\hfill{<%=t 'resumes.pdf.generated' %> \thedate}\vspace{-2mm}\par%
  \rule{\titlefwidth}{1pt}\vspace{2mm} % ruler
}

% Address information
\begin{tabular*}{\textwidth}{@{}l l @{\extracolsep{\fill}} @{}}
\iconl{\bf \Large \textborn} {\bf <%= t('resumes.pdf.dob') %>:} & <%= @r.birthdate %> \\
\iconl{\Telefon} {\bf <%=t 'resumes.pdf.phone' %>:}  & <%= @r.phone %> \\
\iconl{\Letter} {\bf <%=t 'resumes.pdf.email' %>:} & \href{mailto:<%= @r.email %>}{\tt <%= @r.email %>} \\
<% if linkedin %>
  \iconl{\bf \Large \textborn} {\bf <%=t 'resumes.pdf.linkedin' %>:} & \href{<%= linkedin[0] %>}{\tt <%= linkedin[1] %>} \\
<% end %>
\end{tabular*}

% Profile image
<% if @r.image? %>
  \begin{textblock}{1.5}(9.3,1.3)
  \includegraphics[width=\textwidth]{<%= @r.image.current_path %>}
  \end{textblock}
<% end %>

% Logo
<% if @logo_path %>
  \begin{textblock}{3.3}(11.1,1.3)
  \href{http://studieresan.se}{\includegraphics[width=\textwidth]{<%= @logo_path %>}}
  \end{textblock}
<% end %>

<% Experience::KINDS.each do |kind| %>
  <% if experiences[kind].is_a?(Array) && experiences[kind].count > 0 %>
    \section*{<%=htex t_experience_kind(kind) %>}
    <% experiences[kind].each do |exp| %>
      \theplace [, <%=htex exp.location %>]{{}{<%=htex exp.organization %>}}
      \thework{<%=htex exp.title %>}{\mbox{<%=htex "#{exp.start_date.strftime('%Y.%m')}-#{exp.end_date ? exp.end_date.strftime('%Y.%m') : t('values.present')}" %>}}
      <%= exp.description.present? ? htex(exp.description) : '\\vspace{3mm}' %>
    <% end %>
  <% end %>
<% end %>

\section*{<%=htex t_attribute(:resume, :skills)  %>}

<%=htex @r.skills.join ', ' %>

\end{document}
